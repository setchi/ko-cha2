/*! fancyBox v2.1.5 fancyapps.com | fancyapps.com/fancybox/#license */
(function(r,G,f,v){var J=f("html"),n=f(r),p=f(G),b=f.fancybox=function(){b.open.apply(this,arguments)},I=navigator.userAgent.match(/msie/i),B=null,s=G.createTouch!==v,t=function(a){return a&&a.hasOwnProperty&&a instanceof f},q=function(a){return a&&"string"===f.type(a)},E=function(a){return q(a)&&0<a.indexOf("%")},l=function(a,d){var e=parseInt(a,10)||0;d&&E(a)&&(e*=b.getViewport()[d]/100);return Math.ceil(e)},w=function(a,b){return l(a,b)+"px"};f.extend(b,{version:"2.1.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,pixelRatio:1,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!s,fitToView:!0,aspectRatio:!1,topRatio:0.5,leftRatio:0.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3E3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+
(I?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:f.noop,beforeLoad:f.noop,afterLoad:f.noop,beforeShow:f.noop,afterShow:f.noop,beforeChange:f.noop,beforeClose:f.noop,afterClose:f.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(a,d){if(a&&(f.isPlainObject(d)||(d={}),!1!==b.close(!0)))return f.isArray(a)||(a=t(a)?f(a).get():[a]),f.each(a,function(e,c){var k={},g,h,j,m,l;"object"===f.type(c)&&(c.nodeType&&(c=f(c)),t(c)?(k={href:c.data("fancybox-href")||c.attr("href"),title:c.data("fancybox-title")||c.attr("title"),isDom:!0,element:c},f.metadata&&f.extend(!0,k,c.metadata())):k=c);g=d.href||k.href||(q(c)?c:null);h=d.title!==v?d.title:k.title||"";m=(j=d.content||k.content)?"html":d.type||k.type;!m&&k.isDom&&(m=c.data("fancybox-type"),m||(m=(m=c.prop("class").match(/fancybox\.(\w+)/))?m[1]:null));q(g)&&(m||(b.isImage(g)?m="image":b.isSWF(g)?m="swf":"#"===g.charAt(0)?m="inline":q(c)&&(m="html",j=c)),"ajax"===m&&(l=g.split(/\s+/,2),g=l.shift(),l=l.shift()));j||("inline"===m?g?j=f(q(g)?g.replace(/.*(?=#[^\s]+$)/,""):g):k.isDom&&(j=c):"html"===m?j=g:!m&&(!g&&k.isDom)&&(m="inline",j=c));f.extend(k,{href:g,type:m,content:j,title:h,selector:l});a[e]=k}),b.opts=f.extend(!0,{},b.defaults,d),d.keys!==v&&(b.opts.keys=d.keys?f.extend({},b.defaults.keys,d.keys):!1),b.group=a,b._start(b.opts.index)},cancel:function(){var a=b.coming;a&&!1!==b.trigger("onCancel")&&(b.hideLoading(),b.ajaxLoad&&b.ajaxLoad.abort(),b.ajaxLoad=null,b.imgPreload&&(b.imgPreload.onload=b.imgPreload.onerror=null),a.wrap&&a.wrap.stop(!0,!0).trigger("onReset").remove(),b.coming=null,b.current||b._afterZoomOut(a))},close:function(a){b.cancel();!1!==b.trigger("beforeClose")&&(b.unbindEvents(),b.isActive&&(!b.isOpen||!0===a?(f(".fancybox-wrap").stop(!0).trigger("onReset").remove(),b._afterZoomOut()):(b.isOpen=b.isOpened=!1,b.isClosing=!0,f(".fancybox-item, .fancybox-nav").remove(),b.wrap.stop(!0,!0).removeClass("fancybox-opened"),b.transitions[b.current.closeMethod]())))},play:function(a){var d=function(){clearTimeout(b.player.timer)},e=function(){d();b.current&&b.player.isActive&&(b.player.timer=setTimeout(b.next,b.current.playSpeed))},c=function(){d();p.unbind(".player");b.player.isActive=!1;b.trigger("onPlayEnd")};if(!0===a||!b.player.isActive&&!1!==a){if(b.current&&(b.current.loop||b.current.index<b.group.length-1))b.player.isActive=!0,p.bind({"onCancel.player beforeClose.player":c,"onUpdate.player":e,"beforeLoad.player":d}),e(),b.trigger("onPlayStart")}else c()},next:function(a){var d=b.current;d&&(q(a)||(a=d.direction.next),b.jumpto(d.index+1,a,"next"))},prev:function(a){var d=b.current;d&&(q(a)||(a=d.direction.prev),b.jumpto(d.index-1,a,"prev"))},jumpto:function(a,d,e){var c=b.current;c&&(a=l(a),b.direction=d||c.direction[a>=c.index?"next":"prev"],b.router=e||"jumpto",c.loop&&(0>a&&(a=c.group.length+a%c.group.length),a%=c.group.length),c.group[a]!==v&&(b.cancel(),b._start(a)))},reposition:function(a,d){var e=b.current,c=e?e.wrap:null,k;c&&(k=b._getPosition(d),a&&"scroll"===a.type?(delete k.position,c.stop(!0,!0).animate(k,200)):(c.css(k),e.pos=f.extend({},e.dim,k)))},update:function(a){var d=a&&a.type,e=!d||"orientationchange"===d;e&&(clearTimeout(B),B=null);b.isOpen&&!B&&(B=setTimeout(function(){var c=b.current;c&&!b.isClosing&&(b.wrap.removeClass("fancybox-tmp"),(e||"load"===d||"resize"===d&&c.autoResize)&&b._setDimension(),"scroll"===d&&c.canShrink||b.reposition(a),b.trigger("onUpdate"),B=null)},e&&!s?0:300))},toggle:function(a){b.isOpen&&(b.current.fitToView="boolean"===f.type(a)?a:!b.current.fitToView,s&&(b.wrap.removeAttr("style").addClass("fancybox-tmp"),b.trigger("onUpdate")),b.update())},hideLoading:function(){p.unbind(".loading");f("#fancybox-loading").remove()},showLoading:function(){var a,d;b.hideLoading();a=f('<div id="fancybox-loading"><div></div></div>').click(b.cancel).appendTo("body");p.bind("keydown.loading",function(a){if(27===(a.which||a.keyCode))a.preventDefault(),b.cancel()});b.defaults.fixed||(d=b.getViewport(),a.css({position:"absolute",top:0.5*d.h+d.y,left:0.5*d.w+d.x}))},getViewport:function(){var a=b.current&&b.current.locked||!1,d={x:n.scrollLeft(),y:n.scrollTop()};a?(d.w=a[0].clientWidth,d.h=a[0].clientHeight):(d.w=s&&r.innerWidth?r.innerWidth:n.width(),d.h=s&&r.innerHeight?r.innerHeight:n.height());return d},unbindEvents:function(){b.wrap&&t(b.wrap)&&b.wrap.unbind(".fb");p.unbind(".fb");n.unbind(".fb")},bindEvents:function(){var a=b.current,d;a&&(n.bind("orientationchange.fb"+(s?"":" resize.fb")+(a.autoCenter&&!a.locked?" scroll.fb":""),b.update),(d=a.keys)&&p.bind("keydown.fb",function(e){var c=e.which||e.keyCode,k=e.target||e.srcElement;if(27===c&&b.coming)return!1;!e.ctrlKey&&(!e.altKey&&!e.shiftKey&&!e.metaKey&&(!k||!k.type&&!f(k).is("[contenteditable]")))&&f.each(d,function(d,k){if(1<a.group.length&&k[c]!==v)return b[d](k[c]),e.preventDefault(),!1;if(-1<f.inArray(c,k))return b[d](),e.preventDefault(),!1})}),f.fn.mousewheel&&a.mouseWheel&&b.wrap.bind("mousewheel.fb",function(d,c,k,g){for(var h=f(d.target||null),j=!1;h.length&&!j&&!h.is(".fancybox-skin")&&!h.is(".fancybox-wrap");)j=h[0]&&!(h[0].style.overflow&&"hidden"===h[0].style.overflow)&&(h[0].clientWidth&&h[0].scrollWidth>h[0].clientWidth||h[0].clientHeight&&h[0].scrollHeight>h[0].clientHeight),h=f(h).parent();if(0!==c&&!j&&1<b.group.length&&!a.canShrink){if(0<g||0<k)b.prev(0<g?"down":"left");else if(0>g||0>k)b.next(0>g?"up":"right");d.preventDefault()}}))},trigger:function(a,d){var e,c=d||b.coming||b.current;if(c){f.isFunction(c[a])&&(e=c[a].apply(c,Array.prototype.slice.call(arguments,1)));if(!1===e)return!1;c.helpers&&f.each(c.helpers,function(d,e){if(e&&b.helpers[d]&&f.isFunction(b.helpers[d][a]))b.helpers[d][a](f.extend(!0,{},b.helpers[d].defaults,e),c)});p.trigger(a)}},isImage:function(a){return q(a)&&a.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSWF:function(a){return q(a)&&a.match(/\.(swf)((\?|#).*)?$/i)},_start:function(a){var d={},e,c;a=l(a);e=b.group[a]||null;if(!e)return!1;d=f.extend(!0,{},b.opts,e);e=d.margin;c=d.padding;"number"===f.type(e)&&(d.margin=[e,e,e,e]);"number"===f.type(c)&&(d.padding=[c,c,c,c]);d.modal&&f.extend(!0,d,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}});d.autoSize&&(d.autoWidth=d.autoHeight=!0);"auto"===d.width&&(d.autoWidth=!0);"auto"===d.height&&(d.autoHeight=!0);d.group=b.group;d.index=a;b.coming=d;if(!1===b.trigger("beforeLoad"))b.coming=null;else{c=d.type;e=d.href;if(!c)return b.coming=null,b.current&&b.router&&"jumpto"!==b.router?(b.current.index=a,b[b.router](b.direction)):!1;b.isActive=!0;if("image"===c||"swf"===c)d.autoHeight=d.autoWidth=!1,d.scrolling="visible";"image"===c&&(d.aspectRatio=!0);"iframe"===c&&s&&(d.scrolling="scroll");d.wrap=f(d.tpl.wrap).addClass("fancybox-"+(s?"mobile":"desktop")+" fancybox-type-"+c+" fancybox-tmp "+d.wrapCSS).appendTo(d.parent||"body");f.extend(d,{skin:f(".fancybox-skin",d.wrap),outer:f(".fancybox-outer",d.wrap),inner:f(".fancybox-inner",d.wrap)});f.each(["Top","Right","Bottom","Left"],function(a,b){d.skin.css("padding"+b,w(d.padding[a]))});b.trigger("onReady");if("inline"===c||"html"===c){if(!d.content||!d.content.length)return b._error("content")}else if(!e)return b._error("href");"image"===c?b._loadImage():"ajax"===c?b._loadAjax():"iframe"===c?b._loadIframe():b._afterLoad()}},_error:function(a){f.extend(b.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:a,content:b.coming.tpl.error});b._afterLoad()},_loadImage:function(){var a=b.imgPreload=new Image;a.onload=function(){this.onload=this.onerror=null;b.coming.width=this.width/b.opts.pixelRatio;b.coming.height=this.height/b.opts.pixelRatio;b._afterLoad()};a.onerror=function(){this.onload=this.onerror=null;b._error("image")};a.src=b.coming.href;!0!==a.complete&&b.showLoading()},_loadAjax:function(){var a=b.coming;b.showLoading();b.ajaxLoad=f.ajax(f.extend({},a.ajax,{url:a.href,error:function(a,e){b.coming&&"abort"!==e?b._error("ajax",a):b.hideLoading()},success:function(d,e){"success"===e&&(a.content=d,b._afterLoad())}}))},_loadIframe:function(){var a=b.coming,d=f(a.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",s?"auto":a.iframe.scrolling).attr("src",a.href);f(a.wrap).bind("onReset",function(){try{f(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(a){}});a.iframe.preload&&(b.showLoading(),d.one("load",function(){f(this).data("ready",1);s||f(this).bind("load.fb",b.update);f(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show();b._afterLoad()}));a.content=d.appendTo(a.inner);a.iframe.preload||b._afterLoad()},_preloadImages:function(){var a=b.group,d=b.current,e=a.length,c=d.preload?Math.min(d.preload,e-1):0,f,g;for(g=1;g<=c;g+=1)f=a[(d.index+g)%e],"image"===f.type&&f.href&&((new Image).src=f.href)},_afterLoad:function(){var a=b.coming,d=b.current,e,c,k,g,h;b.hideLoading();if(a&&!1!==b.isActive)if(!1===b.trigger("afterLoad",a,d))a.wrap.stop(!0).trigger("onReset").remove(),b.coming=null;else{d&&(b.trigger("beforeChange",d),d.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove());b.unbindEvents();e=a.content;c=a.type;k=a.scrolling;f.extend(b,{wrap:a.wrap,skin:a.skin,outer:a.outer,inner:a.inner,current:a,previous:d});g=a.href;switch(c){case"inline":case"ajax":case"html":a.selector?e=f("<div>").html(e).find(a.selector):t(e)&&(e.data("fancybox-placeholder")||e.data("fancybox-placeholder",f('<div class="fancybox-placeholder"></div>').insertAfter(e).hide()),e=e.show().detach(),a.wrap.bind("onReset",function(){f(this).find(e).length&&e.hide().replaceAll(e.data("fancybox-placeholder")).data("fancybox-placeholder",!1)}));break;case"image":e=a.tpl.image.replace("{href}",g);break;case"swf":e='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+g+'"></param>',h="",f.each(a.swf,function(a,b){e+='<param name="'+a+'" value="'+b+'"></param>';h+=" "+a+'="'+b+'"'}),e+='<embed src="'+g+'" type="application/x-shockwave-flash" width="100%" height="100%"'+h+"></embed></object>"}(!t(e)||!e.parent().is(a.inner))&&a.inner.append(e);b.trigger("beforeShow");a.inner.css("overflow","yes"===k?"scroll":"no"===k?"hidden":k);b._setDimension();b.reposition();b.isOpen=!1;b.coming=null;b.bindEvents();if(b.isOpened){if(d.prevMethod)b.transitions[d.prevMethod]()}else f(".fancybox-wrap").not(a.wrap).stop(!0).trigger("onReset").remove();b.transitions[b.isOpened?a.nextMethod:a.openMethod]();b._preloadImages()}},_setDimension:function(){var a=b.getViewport(),d=0,e=!1,c=!1,e=b.wrap,k=b.skin,g=b.inner,h=b.current,c=h.width,j=h.height,m=h.minWidth,u=h.minHeight,n=h.maxWidth,p=h.maxHeight,s=h.scrolling,q=h.scrollOutside?h.scrollbarWidth:0,x=h.margin,y=l(x[1]+x[3]),r=l(x[0]+x[2]),v,z,t,C,A,F,B,D,H;e.add(k).add(g).width("auto").height("auto").removeClass("fancybox-tmp");x=l(k.outerWidth(!0)-k.width());v=l(k.outerHeight(!0)-k.height());z=y+x;t=r+v;C=E(c)?(a.w-z)*l(c)/100:c;A=E(j)?(a.h-t)*l(j)/100:j;if("iframe"===h.type){if(H=h.content,h.autoHeight&&1===H.data("ready"))try{H[0].contentWindow.document.location&&(g.width(C).height(9999),F=H.contents().find("body"),q&&F.css("overflow-x","hidden"),A=F.outerHeight(!0))}catch(G){}}else if(h.autoWidth||h.autoHeight)g.addClass("fancybox-tmp"),h.autoWidth||g.width(C),h.autoHeight||g.height(A),h.autoWidth&&(C=g.width()),h.autoHeight&&(A=g.height()),g.removeClass("fancybox-tmp");c=l(C);j=l(A);D=C/A;m=l(E(m)?l(m,"w")-z:m);n=l(E(n)?l(n,"w")-z:n);u=l(E(u)?l(u,"h")-t:u);p=l(E(p)?l(p,"h")-t:p);F=n;B=p;h.fitToView&&(n=Math.min(a.w-z,n),p=Math.min(a.h-t,p));z=a.w-y;r=a.h-r;h.aspectRatio?(c>n&&(c=n,j=l(c/D)),j>p&&(j=p,c=l(j*D)),c<m&&(c=m,j=l(c/D)),j<u&&(j=u,c=l(j*D))):(c=Math.max(m,Math.min(c,n)),h.autoHeight&&"iframe"!==h.type&&(g.width(c),j=g.height()),j=Math.max(u,Math.min(j,p)));if(h.fitToView)if(g.width(c).height(j),e.width(c+x),a=e.width(),y=e.height(),h.aspectRatio)for(;(a>z||y>r)&&(c>m&&j>u)&&!(19<d++);)j=Math.max(u,Math.min(p,j-10)),c=l(j*D),c<m&&(c=m,j=l(c/D)),c>n&&(c=n,j=l(c/D)),g.width(c).height(j),e.width(c+x),a=e.width(),y=e.height();else c=Math.max(m,Math.min(c,c-(a-z))),j=Math.max(u,Math.min(j,j-(y-r)));q&&("auto"===s&&j<A&&c+x+q<z)&&(c+=q);g.width(c).height(j);e.width(c+x);a=e.width();y=e.height();e=(a>z||y>r)&&c>m&&j>u;c=h.aspectRatio?c<F&&j<B&&c<C&&j<A:(c<F||j<B)&&(c<C||j<A);f.extend(h,{dim:{width:w(a),height:w(y)},origWidth:C,origHeight:A,canShrink:e,canExpand:c,wPadding:x,hPadding:v,wrapSpace:y-k.outerHeight(!0),skinSpace:k.height()-j});!H&&(h.autoHeight&&j>u&&j<p&&!c)&&g.height("auto")},_getPosition:function(a){var d=b.current,e=b.getViewport(),c=d.margin,f=b.wrap.width()+c[1]+c[3],g=b.wrap.height()+c[0]+c[2],c={position:"absolute",top:c[0],left:c[3]};d.autoCenter&&d.fixed&&!a&&g<=e.h&&f<=e.w?c.position="fixed":d.locked||(c.top+=e.y,c.left+=e.x);c.top=w(Math.max(c.top,c.top+(e.h-g)*d.topRatio));c.left=w(Math.max(c.left,c.left+(e.w-f)*d.leftRatio));return c},_afterZoomIn:function(){var a=b.current;a&&(b.isOpen=b.isOpened=!0,b.wrap.css("overflow","visible").addClass("fancybox-opened"),b.update(),(a.closeClick||a.nextClick&&1<b.group.length)&&b.inner.css("cursor","pointer").bind("click.fb",function(d){!f(d.target).is("a")&&!f(d.target).parent().is("a")&&(d.preventDefault(),b[a.closeClick?"close":"next"]())}),a.closeBtn&&f(a.tpl.closeBtn).appendTo(b.skin).bind("click.fb",function(a){a.preventDefault();b.close()}),a.arrows&&1<b.group.length&&((a.loop||0<a.index)&&f(a.tpl.prev).appendTo(b.outer).bind("click.fb",b.prev),(a.loop||a.index<b.group.length-1)&&f(a.tpl.next).appendTo(b.outer).bind("click.fb",b.next)),b.trigger("afterShow"),!a.loop&&a.index===a.group.length-1?b.play(!1):b.opts.autoPlay&&!b.player.isActive&&(b.opts.autoPlay=!1,b.play()))},_afterZoomOut:function(a){a=a||b.current;f(".fancybox-wrap").trigger("onReset").remove();f.extend(b,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null});b.trigger("afterClose",a)}});b.transitions={getOrigPosition:function(){var a=b.current,d=a.element,e=a.orig,c={},f=50,g=50,h=a.hPadding,j=a.wPadding,m=b.getViewport();!e&&(a.isDom&&d.is(":visible"))&&(e=d.find("img:first"),e.length||(e=d));t(e)?(c=e.offset(),e.is("img")&&(f=e.outerWidth(),g=e.outerHeight())):(c.top=m.y+(m.h-g)*a.topRatio,c.left=m.x+(m.w-f)*a.leftRatio);if("fixed"===b.wrap.css("position")||a.locked)c.top-=m.y,c.left-=m.x;return c={top:w(c.top-h*a.topRatio),left:w(c.left-j*a.leftRatio),width:w(f+j),height:w(g+h)}},step:function(a,d){var e,c,f=d.prop;c=b.current;var g=c.wrapSpace,h=c.skinSpace;if("width"===f||"height"===f)e=d.end===d.start?1:(a-d.start)/(d.end-d.start),b.isClosing&&(e=1-e),c="width"===f?c.wPadding:c.hPadding,c=a-c,b.skin[f](l("width"===f?c:c-g*e)),b.inner[f](l("width"===f?c:c-g*e-h*e))},zoomIn:function(){var a=b.current,d=a.pos,e=a.openEffect,c="elastic"===e,k=f.extend({opacity:1},d);delete k.position;c?(d=this.getOrigPosition(),a.openOpacity&&(d.opacity=0.1)):"fade"===e&&(d.opacity=0.1);b.wrap.css(d).animate(k,{duration:"none"===e?0:a.openSpeed,easing:a.openEasing,step:c?this.step:null,complete:b._afterZoomIn})},zoomOut:function(){var a=b.current,d=a.closeEffect,e="elastic"===d,c={opacity:0.1};e&&(c=this.getOrigPosition(),a.closeOpacity&&(c.opacity=0.1));b.wrap.animate(c,{duration:"none"===d?0:a.closeSpeed,easing:a.closeEasing,step:e?this.step:null,complete:b._afterZoomOut})},changeIn:function(){var a=b.current,d=a.nextEffect,e=a.pos,c={opacity:1},f=b.direction,g;e.opacity=0.1;"elastic"===d&&(g="down"===f||"up"===f?"top":"left","down"===f||"right"===f?(e[g]=w(l(e[g])-200),c[g]="+=200px"):(e[g]=w(l(e[g])+200),c[g]="-=200px"));"none"===d?b._afterZoomIn():b.wrap.css(e).animate(c,{duration:a.nextSpeed,easing:a.nextEasing,complete:b._afterZoomIn})},changeOut:function(){var a=b.previous,d=a.prevEffect,e={opacity:0.1},c=b.direction;"elastic"===d&&(e["down"===c||"up"===c?"top":"left"]=("up"===c||"left"===c?"-":"+")+"=200px");a.wrap.animate(e,{duration:"none"===d?0:a.prevSpeed,easing:a.prevEasing,complete:function(){f(this).trigger("onReset").remove()}})}};b.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!s,fixed:!0},overlay:null,fixed:!1,el:f("html"),create:function(a){a=f.extend({},this.defaults,a);this.overlay&&this.close();this.overlay=f('<div class="fancybox-overlay"></div>').appendTo(b.coming?b.coming.parent:a.parent);this.fixed=!1;a.fixed&&b.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(a){var d=this;a=f.extend({},this.defaults,a);this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(a);this.fixed||(n.bind("resize.overlay",f.proxy(this.update,this)),this.update());a.closeClick&&this.overlay.bind("click.overlay",function(a){if(f(a.target).hasClass("fancybox-overlay"))return b.isActive?b.close():d.close(),!1});this.overlay.css(a.css).show()},close:function(){var a,b;n.unbind("resize.overlay");this.el.hasClass("fancybox-lock")&&(f(".fancybox-margin").removeClass("fancybox-margin"),a=n.scrollTop(),b=n.scrollLeft(),this.el.removeClass("fancybox-lock"),n.scrollTop(a).scrollLeft(b));f(".fancybox-overlay").remove().hide();f.extend(this,{overlay:null,fixed:!1})},update:function(){var a="100%",b;this.overlay.width(a).height("100%");I?(b=Math.max(G.documentElement.offsetWidth,G.body.offsetWidth),p.width()>b&&(a=p.width())):p.width()>n.width()&&(a=p.width());this.overlay.width(a).height(p.height())},onReady:function(a,b){var e=this.overlay;f(".fancybox-overlay").stop(!0,!0);e||this.create(a);a.locked&&(this.fixed&&b.fixed)&&(e||(this.margin=p.height()>n.height()?f("html").css("margin-right").replace("px",""):!1),b.locked=this.overlay.append(b.wrap),b.fixed=!1);!0===a.showEarly&&this.beforeShow.apply(this,arguments)},beforeShow:function(a,b){var e,c;b.locked&&(!1!==this.margin&&(f("*").filter(function(){return"fixed"===f(this).css("position")&&!f(this).hasClass("fancybox-overlay")&&!f(this).hasClass("fancybox-wrap")}).addClass("fancybox-margin"),this.el.addClass("fancybox-margin")),e=n.scrollTop(),c=n.scrollLeft(),this.el.addClass("fancybox-lock"),n.scrollTop(e).scrollLeft(c));this.open(a)},onUpdate:function(){this.fixed||this.update()},afterClose:function(a){this.overlay&&!b.coming&&this.overlay.fadeOut(a.speedOut,f.proxy(this.close,this))}};b.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(a){var d=b.current,e=d.title,c=a.type;f.isFunction(e)&&(e=e.call(d.element,d));if(q(e)&&""!==f.trim(e)){d=f('<div class="fancybox-title fancybox-title-'+c+'-wrap">'+e+"</div>");switch(c){case"inside":c=b.skin;break;case"outside":c=b.wrap;break;case"over":c=b.inner;break;default:c=b.skin,d.appendTo("body"),I&&d.width(d.width()),d.wrapInner('<span class="child"></span>'),b.current.margin[2]+=Math.abs(l(d.css("margin-bottom")))}d["top"===a.position?"prependTo":"appendTo"](c)}}};f.fn.fancybox=function(a){var d,e=f(this),c=this.selector||"",k=function(g){var h=f(this).blur(),j=d,k,l;!g.ctrlKey&&(!g.altKey&&!g.shiftKey&&!g.metaKey)&&!h.is(".fancybox-wrap")&&(k=a.groupAttr||"data-fancybox-group",l=h.attr(k),l||(k="rel",l=h.get(0)[k]),l&&(""!==l&&"nofollow"!==l)&&(h=c.length?f(c):e,h=h.filter("["+k+'="'+l+'"]'),j=h.index(this)),a.index=j,!1!==b.open(h,a)&&g.preventDefault())};a=a||{};d=a.index||0;!c||!1===a.live?e.unbind("click.fb-start").bind("click.fb-start",k):p.undelegate(c,"click.fb-start").delegate(c+":not('.fancybox-item, .fancybox-nav')","click.fb-start",k);this.filter("[data-fancybox-start=1]").trigger("click");return this};p.ready(function(){var a,d;f.scrollbarWidth===v&&(f.scrollbarWidth=function(){var a=f('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),b=a.children(),b=b.innerWidth()-b.height(99).innerWidth();a.remove();return b});if(f.support.fixedPosition===v){a=f.support;d=f('<div style="position:fixed;top:20px;"></div>').appendTo("body");var e=20===d[0].offsetTop||15===d[0].offsetTop;d.remove();a.fixedPosition=e}f.extend(b.defaults,{scrollbarWidth:f.scrollbarWidth(),fixed:f.support.fixedPosition,parent:f("body")});a=f(r).width();J.addClass("fancybox-lock-test");d=f(r).width();J.removeClass("fancybox-lock-test");f("<style type='text/css'>.fancybox-margin{margin-right:"+(d-a)+"px;}</style>").appendTo("head")})})(window,document,jQuery);
(function(e,n){function C(a){a=a.split(/\s+/);for(var b=[],c=0,d;d=a[c];c++)d=d[0].toUpperCase(),b.push(d);return b}function s(a){return a.id&&e('label[for="'+a.id+'"]').val()||a.name}function A(a,b,c){c||(c=0);b.each(function(){var b=e(this),g=this,k=this.nodeName.toLowerCase(),h,f;"label"==k&&b.find("input, textarea, select").length&&(h=b.text(),b=b.children().first(),g=b.get(0),k=g.nodeName.toLowerCase());switch(k){case"menu":f={name:b.attr("label"),items:{}};c=A(f.items,b.children(),c);break;case"a":case"button":f={name:b.text(),disabled:!!b.attr("disabled"),callback:function(){return function(){b.click()}}()};break;case"menuitem":case"command":switch(b.attr("type")){case n:case"command":case"menuitem":f={name:b.attr("label"),disabled:!!b.attr("disabled"),callback:function(){return function(){b.click()}}()};break;case"checkbox":f={type:"checkbox",disabled:!!b.attr("disabled"),name:b.attr("label"),selected:!!b.attr("checked")};break;case"radio":f={type:"radio",disabled:!!b.attr("disabled"),name:b.attr("label"),radio:b.attr("radiogroup"),value:b.attr("id"),selected:!!b.attr("checked")};break;default:f=n}break;case"hr":f="-------";break;case"input":switch(b.attr("type")){case"text":f={type:"text",name:h||s(g),disabled:!!b.attr("disabled"),value:b.val()};break;case"checkbox":f={type:"checkbox",name:h||s(g),disabled:!!b.attr("disabled"),selected:!!b.attr("checked")};break;case"radio":f={type:"radio",name:h||s(g),disabled:!!b.attr("disabled"),radio:!!b.attr("name"),value:b.val(),selected:!!b.attr("checked")};break;default:f=n}break;case"select":f={type:"select",name:h||s(g),disabled:!!b.attr("disabled"),selected:b.val(),options:{}};b.children().each(function(){f.options[this.value]=e(this).text()});break;case"textarea":f={type:"textarea",name:h||s(g),disabled:!!b.attr("disabled"),value:b.val()};break;case"label":break;default:f={type:"html",html:b.clone(!0)}}f&&(c++,a["key"+c]=f)});return c}e.support.htmlMenuitem="HTMLMenuItemElement"in window;e.support.htmlCommand="HTMLCommandElement"in window;e.support.eventSelectstart="onselectstart"in document.documentElement;if(!e.ui||!e.ui.widget){var D=e.cleanData;e.cleanData=function(a){for(var b=0,c;null!=(c=a[b]);b++)try{e(c).triggerHandler("remove")}catch(d){}D(a)}}var l=null,u=!1,q=e(window),v=0,r={},m={},w={},x={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,determinePosition:function(a){if(e.ui&&e.ui.position)a.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var b=this.offset();b.top+=this.outerHeight();b.left+=this.outerWidth()/2-a.outerWidth()/2;a.css(b)}},position:function(a,b,c){if(b||c){b="maintain"===b&&"maintain"===c?a.$menu.position():{top:c,left:b};c=q.scrollTop()+q.height();var d=q.scrollLeft()+q.width(),e=a.$menu.height(),f=a.$menu.width();b.top+e>c&&(b.top-=e);b.left+f>d&&(b.left-=f);a.$menu.css(b)}else a.determinePosition.call(this,a.$menu)},positionSubmenu:function(a){if(e.ui&&e.ui.position)a.css("display","block").position({my:"left top",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var b={top:0,left:this.outerWidth()};a.css(b)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},t=null,y=null,z=null,B,E=function(a){for(var b=0;b=Math.max(b,parseInt(a.css("z-index"),10)||0),a=a.parent(),a&&a.length&&!(-1<"html body".indexOf(a.prop("nodeName").toLowerCase())););return b},f={abortevent:function(a){a.preventDefault();a.stopImmediatePropagation()},contextmenu:function(a){var b=e(this);a.preventDefault();a.stopImmediatePropagation();if(!("right"!=a.data.trigger&&a.originalEvent||b.hasClass("context-menu-active")||b.hasClass("context-menu-disabled"))){l=b;if(a.data.build){var c=a.data.build(l,a);if(!1===c)return;a.data=e.extend(!0,{},x,a.data,c||{});if(!a.data.items||e.isEmptyObject(a.data.items))throw window.console&&(console.error||console.log)("No items specified to show in contextMenu"),Error("No Items specified");a.data.$trigger=l;p.create(a.data)}p.show.call(b,a.data,a.pageX,a.pageY)}},click:function(a){a.preventDefault();a.stopImmediatePropagation();e(this).trigger(e.Event("contextmenu",{data:a.data,pageX:a.pageX,pageY:a.pageY}))},mousedown:function(a){var b=e(this);l&&l.length&&!l.is(b)&&l.data("contextMenu").$menu.trigger("contextmenu:hide");2==a.button&&(l=b.data("contextMenuActive",!0))},mouseup:function(a){var b=e(this);b.data("contextMenuActive")&&l&&l.length&&l.is(b)&&!b.hasClass("context-menu-disabled")&&(a.preventDefault(),a.stopImmediatePropagation(),l=b,b.trigger(e.Event("contextmenu",{data:a.data,pageX:a.pageX,pageY:a.pageY})));b.removeData("contextMenuActive")},mouseenter:function(a){var b=e(this),c=e(a.relatedTarget),d=e(document);c.is(".context-menu-list")||c.closest(".context-menu-list").length||l&&l.length||(y=a.pageX,z=a.pageY,B=a.data,d.on("mousemove.contextMenuShow",f.mousemove),t=setTimeout(function(){t=null;d.off("mousemove.contextMenuShow");l=b;b.trigger(e.Event("contextmenu",{data:B,pageX:y,pageY:z}))},a.data.delay))},mousemove:function(a){y=a.pageX;z=a.pageY},mouseleave:function(a){a=e(a.relatedTarget);if(!a.is(".context-menu-list")&&!a.closest(".context-menu-list").length){try{clearTimeout(t)}catch(b){}t=null}},layerClick:function(a){var b=e(this).data("contextMenuRoot"),c=a.button,d=a.pageX,g=a.pageY,f,h;a.preventDefault();a.stopImmediatePropagation();setTimeout(function(){var l,m="left"==b.trigger&&0===c||"right"==b.trigger&&2===c;document.elementFromPoint&&(b.$layer.hide(),f=document.elementFromPoint(d-q.scrollLeft(),g-q.scrollTop()),b.$layer.show());if(b.reposition&&m)if(document.elementFromPoint){if(b.$trigger.is(f)||b.$trigger.has(f).length){b.position.call(b.$trigger,b,d,g);return}}else if(h=b.$trigger.offset(),l=e(window),h.top+=l.scrollTop(),h.top<=a.pageY&&(h.left+=l.scrollLeft(),h.left<=a.pageX&&(h.bottom=h.top+b.$trigger.outerHeight(),h.bottom>=a.pageY&&(h.right=h.left+b.$trigger.outerWidth(),h.right>=a.pageX)))){b.position.call(b.$trigger,b,d,g);return}if(f&&m)b.$trigger.one("contextmenu:hidden",function(){e(f).contextMenu({x:d,y:g})});b.$menu.trigger("contextmenu:hide")},50)},keyStop:function(a,b){b.isInput||a.preventDefault();a.stopPropagation()},key:function(a){var b=l.data("contextMenu")||{};switch(a.keyCode){case 9:case 38:if(f.keyStop(a,b),b.isInput){if(9==a.keyCode&&a.shiftKey){a.preventDefault();b.$selected&&b.$selected.find("input, textarea, select").blur();b.$menu.trigger("prevcommand");return}if(38==a.keyCode&&"checkbox"==b.$selected.find("input, textarea, select").prop("type")){a.preventDefault();return}}else if(9!=a.keyCode||a.shiftKey){b.$menu.trigger("prevcommand");return}case 40:f.keyStop(a,b);if(b.isInput){if(9==a.keyCode){a.preventDefault();b.$selected&&b.$selected.find("input, textarea, select").blur();b.$menu.trigger("nextcommand");return}if(40==a.keyCode&&"checkbox"==b.$selected.find("input, textarea, select").prop("type")){a.preventDefault();return}}else{b.$menu.trigger("nextcommand");return}break;case 37:f.keyStop(a,b);if(b.isInput||!b.$selected||!b.$selected.length)break;if(!b.$selected.parent().hasClass("context-menu-root")){a=b.$selected.parent().parent();b.$selected.trigger("contextmenu:blur");b.$selected=a;return}break;case 39:f.keyStop(a,b);if(b.isInput||!b.$selected||!b.$selected.length)break;var c=b.$selected.data("contextMenu")||{};if(c.$menu&&b.$selected.hasClass("context-menu-submenu")){b.$selected=null;c.$selected=null;c.$menu.trigger("nextcommand");return}break;case 35:case 36:b.$selected&&b.$selected.find("input, textarea, select").length||((b.$selected&&b.$selected.parent()||b.$menu).children(":not(.disabled, .not-selectable)")[36==a.keyCode?"first":"last"]().trigger("contextmenu:focus"),a.preventDefault());return;case 13:f.keyStop(a,b);if(b.isInput){if(b.$selected&&!b.$selected.is("textarea, select")){a.preventDefault();return}break}b.$selected&&b.$selected.trigger("mouseup");return;case 32:case 33:case 34:f.keyStop(a,b);return;case 27:f.keyStop(a,b);b.$menu.trigger("contextmenu:hide");return;default:if(c=String.fromCharCode(a.keyCode).toUpperCase(),b.accesskeys[c]){b.accesskeys[c].$node.trigger(b.accesskeys[c].$menu?"contextmenu:focus":"mouseup");return}}a.stopPropagation();b.$selected&&b.$selected.trigger(a)},prevItem:function(a){a.stopPropagation();var b=e(this).data("contextMenu")||{};if(b.$selected){var c=b.$selected,b=b.$selected.parent().data("contextMenu")||{};b.$selected=c}for(var c=b.$menu.children(),d=b.$selected&&b.$selected.prev().length?b.$selected.prev():c.last(),g=d;d.hasClass("disabled")||d.hasClass("not-selectable");)if(d=d.prev().length?d.prev():c.last(),d.is(g))return;b.$selected&&f.itemMouseleave.call(b.$selected.get(0),a);f.itemMouseenter.call(d.get(0),a);a=d.find("input, textarea, select");a.length&&a.focus()},nextItem:function(a){a.stopPropagation();var b=e(this).data("contextMenu")||{};if(b.$selected){var c=b.$selected,b=b.$selected.parent().data("contextMenu")||{};b.$selected=c}for(var c=b.$menu.children(),d=b.$selected&&b.$selected.next().length?b.$selected.next():c.first(),g=d;d.hasClass("disabled")||d.hasClass("not-selectable");)if(d=d.next().length?d.next():c.first(),d.is(g))return;b.$selected&&f.itemMouseleave.call(b.$selected.get(0),a);f.itemMouseenter.call(d.get(0),a);a=d.find("input, textarea, select");a.length&&a.focus()},focusInput:function(a){a=e(this).closest(".context-menu-item");var b=a.data(),c=b.contextMenu,b=b.contextMenuRoot;b.$selected=c.$selected=a;b.isInput=c.isInput=!0},blurInput:function(a){a=e(this).closest(".context-menu-item").data();a.contextMenuRoot.isInput=a.contextMenu.isInput=!1},menuMouseenter:function(a){e(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(a){var b=e(this).data().contextMenuRoot;b.$layer&&b.$layer.is(a.relatedTarget)&&(b.hovering=!1)},itemMouseenter:function(a){var b=e(this),c=b.data(),d=c.contextMenu,c=c.contextMenuRoot;c.hovering=!0;a&&c.$layer&&c.$layer.is(a.relatedTarget)&&(a.preventDefault(),a.stopImmediatePropagation());(d.$menu?d:c).$menu.children(".hover").trigger("contextmenu:blur");b.hasClass("disabled")||b.hasClass("not-selectable")?d.$selected=null:b.trigger("contextmenu:focus")},itemMouseleave:function(a){var b=e(this),c=b.data(),d=c.contextMenu,c=c.contextMenuRoot;c!==d&&c.$layer&&c.$layer.is(a.relatedTarget)?(c.$selected&&c.$selected.trigger("contextmenu:blur"),a.preventDefault(),a.stopImmediatePropagation(),c.$selected=d.$selected=d.$node):b.trigger("contextmenu:blur")},itemClick:function(a){var b=e(this),c=b.data(),d=c.contextMenuRoot,f=c.contextMenuKey;if(c.contextMenu.items[f]&&!b.is(".disabled, .context-menu-submenu, .context-menu-separator, .not-selectable")){a.preventDefault();a.stopImmediatePropagation();if(e.isFunction(d.callbacks[f])&&Object.prototype.hasOwnProperty.call(d.callbacks,f))a=d.callbacks[f];else if(e.isFunction(d.callback))a=d.callback;else return;!1!==a.call(d.$trigger,f,d)?d.$menu.trigger("contextmenu:hide"):d.$menu.parent().length&&p.update.call(d.$trigger,d)}},inputClick:function(a){a.stopImmediatePropagation()},hideMenu:function(a,b){var c=e(this).data("contextMenuRoot");p.hide.call(c.$trigger,c,b&&b.force)},focusItem:function(a){a.stopPropagation();a=e(this);var b=a.data(),c=b.contextMenu,b=b.contextMenuRoot;a.addClass("hover").siblings(".hover").trigger("contextmenu:blur");c.$selected=b.$selected=a;c.$node&&b.positionSubmenu.call(c.$node,c.$menu)},blurItem:function(a){a.stopPropagation();a=e(this);var b=a.data().contextMenu;a.removeClass("hover");b.$selected=null}},p={show:function(a,b,c){var d=e(this),g={};e("#context-menu-layer").trigger("mousedown");a.$trigger=d;if(!1===a.events.show.call(d,a))l=null;else if(p.update.call(d,a),a.position.call(d,a,b,c),a.zIndex&&(g.zIndex=E(d)+a.zIndex),p.layer.call(a.$menu,a,g.zIndex),a.$menu.find("ul").css("zIndex",g.zIndex+1),a.$menu.css(g)[a.animation.show](a.animation.duration,function(){d.trigger("contextmenu:visible")}),d.data("contextMenu",a).addClass("context-menu-active"),e(document).off("keydown.contextMenu").on("keydown.contextMenu",f.key),a.autoHide)e(document).on("mousemove.contextMenuAutoHide",function(b){var c=d.offset();c.right=c.left+d.outerWidth();c.bottom=c.top+d.outerHeight();!a.$layer||a.hovering||b.pageX>=c.left&&b.pageX<=c.right&&b.pageY>=c.top&&b.pageY<=c.bottom||a.$menu.trigger("contextmenu:hide")})},hide:function(a,b){var c=e(this);a||(a=c.data("contextMenu")||{});if(b||!a.events||!1!==a.events.hide.call(c,a)){c.removeData("contextMenu").removeClass("context-menu-active");if(a.$layer){setTimeout(function(a){return function(){a.remove()}}(a.$layer),10);try{delete a.$layer}catch(d){a.$layer=null}}l=null;a.$menu.find(".hover").trigger("contextmenu:blur");a.$selected=null;e(document).off(".contextMenuAutoHide").off("keydown.contextMenu");a.$menu&&a.$menu[a.animation.hide](a.animation.duration,function(){a.build&&(a.$menu.remove(),e.each(a,function(b,c){switch(b){case"ns":case"selector":case"build":case"trigger":return!0;default:a[b]=n;try{delete a[b]}catch(d){}return!0}}));setTimeout(function(){c.trigger("contextmenu:hidden")},10)})}},create:function(a,b){b===n&&(b=a);a.$menu=e('<ul class="context-menu-list"></ul>').addClass(a.className||"").data({contextMenu:a,contextMenuRoot:b});e.each(["callbacks","commands","inputs"],function(c,d){a[d]={};b[d]||(b[d]={})});b.accesskeys||(b.accesskeys={});e.each(a.items,function(c,d){var g=e('<li class="context-menu-item"></li>').addClass(d.className||""),k=null,h=null;g.on("click",e.noop);d.$node=g.data({contextMenu:a,contextMenuRoot:b,contextMenuKey:c});if(d.accesskey)for(var l=C(d.accesskey),m=0,n;n=l[m];m++)if(!b.accesskeys[n]){b.accesskeys[n]=d;d._name=d.name.replace(new RegExp("("+n+")","i"),'<span class="context-menu-accesskey">$1</span>');break}if("string"==typeof d)g.addClass("context-menu-separator not-selectable");else if(d.type&&w[d.type])w[d.type].call(g,d,a,b),e.each([a,b],function(a,b){b.commands[c]=d;e.isFunction(d.callback)&&(b.callbacks[c]=d.callback)});else{"html"==d.type?g.addClass("context-menu-html not-selectable"):d.type?(k=e("<label></label>").appendTo(g),e("<span></span>").html(d._name||d.name).appendTo(k),g.addClass("context-menu-input"),a.hasTypes=!0,e.each([a,b],function(a,b){b.commands[c]=d;b.inputs[c]=d})):d.items&&(d.type="sub");switch(d.type){case"text":h=e('<input type="text" value="1" name="" value="">').attr("name","context-menu-input-"+
c).val(d.value||"").appendTo(k);break;case"textarea":h=e('<textarea name=""></textarea>').attr("name","context-menu-input-"+c).val(d.value||"").appendTo(k);d.height&&h.height(d.height);break;case"checkbox":h=e('<input type="checkbox" value="1" name="" value="">').attr("name","context-menu-input-"+c).val(d.value||"").prop("checked",!!d.selected).prependTo(k);break;case"radio":h=e('<input type="radio" value="1" name="" value="">').attr("name","context-menu-input-"+d.radio).val(d.value||"").prop("checked",!!d.selected).prependTo(k);break;case"select":h=e('<select name="">').attr("name","context-menu-input-"+c).appendTo(k);d.options&&(e.each(d.options,function(a,b){e("<option></option>").val(a).text(b).appendTo(h)}),h.val(d.selected));break;case"sub":e("<span></span>").html(d._name||d.name).appendTo(g);d.appendTo=d.$node;p.create(d,b);g.data("contextMenu",d).addClass("context-menu-submenu");d.callback=null;break;case"html":e(d.html).appendTo(g);break;default:e.each([a,b],function(a,b){b.commands[c]=d;e.isFunction(d.callback)&&(b.callbacks[c]=d.callback)}),e("<span></span>").html(d._name||d.name||"").appendTo(g)}if(d.type&&"sub"!=d.type&&"html"!=d.type&&(h.on("focus",f.focusInput).on("blur",f.blurInput),d.events))h.on(d.events,a);d.icon&&g.addClass("icon icon-"+d.icon)}d.$input=h;d.$label=k;g.appendTo(a.$menu);if(!a.hasTypes&&e.support.eventSelectstart)g.on("selectstart.disableTextSelect",f.abortevent)});a.$node||a.$menu.css("display","none").addClass("context-menu-root");a.$menu.appendTo(a.appendTo||document.body)},resize:function(a,b){a.css({position:"absolute",display:"block"});a.data("width",Math.ceil(a.width())+1);a.css({position:"static",minWidth:"0px",maxWidth:"100000px"});a.find("> li > ul").each(function(){p.resize(e(this),!0)});b||a.find("ul").andSelf().css({position:"",display:"",minWidth:"",maxWidth:""}).width(function(){return e(this).data("width")})},update:function(a,b){var c=this;b===n&&(b=a,p.resize(a.$menu));a.$menu.children().each(function(){var d=e(this),f=d.data("contextMenuKey"),k=a.items[f],f=e.isFunction(k.disabled)&&k.disabled.call(c,f,b)||!0===k.disabled;d[f?"addClass":"removeClass"]("disabled");if(k.type)switch(d.find("input, select, textarea").prop("disabled",f),k.type){case"text":case"textarea":k.$input.val(k.value||"");break;case"checkbox":case"radio":k.$input.val(k.value||"").prop("checked",!!k.selected);break;case"select":k.$input.val(k.selected||"")}k.$menu&&p.update.call(c,k,b)})},layer:function(a,b){var c=a.$layer=e('<div id="context-menu-layer" style="position:fixed; z-index:'+
b+'; top:0; left:0; opacity: 0; filter: alpha(opacity=0); background-color: #000;"></div>').css({height:q.height(),width:q.width(),display:"block"}).data("contextMenuRoot",a).insertBefore(this).on("contextmenu",f.abortevent).on("mousedown",f.layerClick);e.support.fixedPosition||c.css({position:"absolute",height:e(document).height()});return c}};e.fn.contextMenu=function(a){a===n?this.first().trigger("contextmenu"):a.x&&a.y?this.first().trigger(e.Event("contextmenu",{pageX:a.x,pageY:a.y})):"hide"===a?(a=this.data("contextMenu").$menu)&&a.trigger("contextmenu:hide"):"destroy"===a?e.contextMenu("destroy",{context:this}):e.isPlainObject(a)?(a.context=this,e.contextMenu("create",a)):a?this.removeClass("context-menu-disabled"):a||this.addClass("context-menu-disabled");return this};e.contextMenu=function(a,b){"string"!=typeof a&&(b=a,a="create");"string"==typeof b?b={selector:b}:b===n&&(b={});var c=e.extend(!0,{},x,b||{}),d=e(document),g=d,k=!1;c.context&&c.context.length?(g=e(c.context).first(),c.context=g.get(0),k=c.context!==document):c.context=document;switch(a){case"create":if(!c.selector)throw Error("No selector specified");if(c.selector.match(/.context-menu-(list|item|input)($|\s)/))throw Error('Cannot bind to selector "'+c.selector+'" as it contains a reserved className');if(!c.build&&(!c.items||e.isEmptyObject(c.items)))throw Error("No Items specified");v++;c.ns=".contextMenu"+v;k||(r[c.selector]=c.ns);m[c.ns]=c;c.trigger||(c.trigger="right");u||(d.on({"contextmenu:hide.contextMenu":f.hideMenu,"prevcommand.contextMenu":f.prevItem,"nextcommand.contextMenu":f.nextItem,"contextmenu.contextMenu":f.abortevent,"mouseenter.contextMenu":f.menuMouseenter,"mouseleave.contextMenu":f.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",f.inputClick).on({"mouseup.contextMenu":f.itemClick,"contextmenu:focus.contextMenu":f.focusItem,"contextmenu:blur.contextMenu":f.blurItem,"contextmenu.contextMenu":f.abortevent,"mouseenter.contextMenu":f.itemMouseenter,"mouseleave.contextMenu":f.itemMouseleave},".context-menu-item"),u=!0);g.on("contextmenu"+c.ns,c.selector,c,f.contextmenu);if(k)g.on("remove"+c.ns,function(){e(this).contextMenu("destroy")});switch(c.trigger){case"hover":g.on("mouseenter"+c.ns,c.selector,c,f.mouseenter).on("mouseleave"+c.ns,c.selector,c,f.mouseleave);break;case"left":g.on("click"+c.ns,c.selector,c,f.click)}c.build||p.create(c);break;case"destroy":var h;if(k){var l=c.context;e.each(m,function(b,a){if(a.context!==l)return!0;h=e(".context-menu-list").filter(":visible");h.length&&h.data().contextMenuRoot.$trigger.is(e(a.context).find(a.selector))&&h.trigger("contextmenu:hide",{force:!0});try{m[a.ns].$menu&&m[a.ns].$menu.remove(),delete m[a.ns]}catch(c){m[a.ns]=null}e(a.context).off(a.ns);return!0})}else if(!c.selector)d.off(".contextMenu .contextMenuAutoHide"),e.each(m,function(a,b){e(b.context).off(b.ns)}),r={},m={},v=0,u=!1,e("#context-menu-layer, .context-menu-list").remove();else if(r[c.selector]){h=e(".context-menu-list").filter(":visible");h.length&&h.data().contextMenuRoot.$trigger.is(c.selector)&&h.trigger("contextmenu:hide",{force:!0});try{m[r[c.selector]].$menu&&m[r[c.selector]].$menu.remove(),delete m[r[c.selector]]}catch(q){m[r[c.selector]]=null}d.off(r[c.selector])}break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||"boolean"==typeof b&&b)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw Error('Unknown operation "'+a+'"');}return this};e.contextMenu.setInputValues=function(a,b){b===n&&(b={});e.each(a.inputs,function(a,d){switch(d.type){case"text":case"textarea":d.value=b[a]||"";break;case"checkbox":d.selected=b[a]?!0:!1;break;case"radio":d.selected=(b[d.radio]||"")==d.value?!0:!1;break;case"select":d.selected=b[a]||""}})};e.contextMenu.getInputValues=function(a,b){b===n&&(b={});e.each(a.inputs,function(a,d){switch(d.type){case"text":case"textarea":case"select":b[a]=d.$input.val();break;case"checkbox":b[a]=d.$input.prop("checked");break;case"radio":d.$input.prop("checked")&&(b[d.radio]=d.value)}});return b};e.contextMenu.fromMenu=function(a){a=e(a);var b={};A(b,a.children());return b};e.contextMenu.defaults=x;e.contextMenu.types=w;e.contextMenu.handle=f;e.contextMenu.op=p;e.contextMenu.menus=m})(jQuery);
(function(root,factory){'use strict';if(typeof define==='function'&&define.amd){define('notify',[],function(){return factory(root,document);});}else if(typeof exports==='object'){module.exports=factory(root,document);}else{root.Notify=factory(root,document);}}(window,function(w,d){'use strict';function Notify(title,options){if(typeof title!=='string'){throw new Error('Notify(): first arg (title) must be a string.');}
this.title=title;this.options={icon:'',body:'',tag:'',notifyShow:null,notifyClose:null,notifyClick:null,notifyError:null,permissionGranted:null,permissionDenied:null,timeout:null};this.permission=null;if(!Notify.isSupported()){return;}
if(typeof options==='object'){for(var i in options){if(options.hasOwnProperty(i)){this.options[i]=options[i];}}
if(typeof this.options.notifyShow==='function'){this.onShowCallback=this.options.notifyShow;}
if(typeof this.options.notifyClose==='function'){this.onCloseCallback=this.options.notifyClose;}
if(typeof this.options.notifyClick==='function'){this.onClickCallback=this.options.notifyClick;}
if(typeof this.options.notifyError==='function'){this.onErrorCallback=this.options.notifyError;}}}
Notify.isSupported=function(){if('Notification'in w){return true;}
return false;};Notify.needsPermission=function(){if(Notify.isSupported()&&Notification.permission==='granted'){return false;}
return true;};Notify.requestPermission=function(onPermissionGrantedCallback,onPermissionDeniedCallback){if(Notify.isSupported()){w.Notification.requestPermission(function(perm){switch(perm){case'granted':if(typeof onPermissionGrantedCallback==='function'){onPermissionGrantedCallback();}
break;case'denied':if(typeof onPermissionDeniedCallback==='function'){onPermissionDeniedCallback();}
break;}});}};Notify.prototype.show=function(){var that=this;if(!Notify.isSupported()){return;}
this.myNotify=new Notification(this.title,{'body':this.options.body,'tag':this.options.tag,'icon':this.options.icon});if(this.options.timeout&&!isNaN(this.options.timeout)){setTimeout(this.close.bind(this),this.options.timeout*1000);}
this.myNotify.addEventListener('show',this,false);this.myNotify.addEventListener('error',this,false);this.myNotify.addEventListener('close',this,false);this.myNotify.addEventListener('click',this,false);};Notify.prototype.onShowNotification=function(e){if(this.onShowCallback){this.onShowCallback(e);}};Notify.prototype.onCloseNotification=function(e){if(this.onCloseCallback){this.onCloseCallback(e);}
this.destroy();};Notify.prototype.onClickNotification=function(e){if(this.onClickCallback){this.onClickCallback(e);}};Notify.prototype.onErrorNotification=function(e){if(this.onErrorCallback){this.onErrorCallback(e);}
this.destroy();};Notify.prototype.destroy=function(){this.myNotify.removeEventListener('show',this,false);this.myNotify.removeEventListener('error',this,false);this.myNotify.removeEventListener('close',this,false);this.myNotify.removeEventListener('click',this,false);};Notify.prototype.close=function(){this.myNotify.close();};Notify.prototype.handleEvent=function(e){switch(e.type){case'show':this.onShowNotification(e);break;case'close':this.onCloseNotification(e);break;case'click':this.onClickNotification(e);break;case'error':this.onErrorNotification(e);break;}};return Notify;}));
function rangeFilter(val,min,max){return val<min?min:val>max?max:val;}
function getSize(obj){var size=0;for(var prop in obj)if(obj.hasOwnProperty(prop)){size++;}
return size;}
function cancelEvent(e){e.preventDefault();e.stopPropagation();return false;}
function sprintf(text){var i=1,args=arguments;return text.replace(/%s/g,function(){return(i<args.length)?args[i++]:"";});}
var roomInfo=JSON.parse($('#js_room_info').text());var Server=function(){this.watch(0,0)};Server.prototype={send:function(data,sync){var async=!sync;$.ajax({url:'/ko-cha2/chat/push/'+roomInfo.room.id+'.json',type:'post',dataType:'json',data:data,async:async}).done(function(e){if(e['error']){location.reload();console.warn('Error!',e);}});},watch:function(lastChatId,lastTime){var that=this;$.ajax({url:'/ko-cha2/chat/watch/'+roomInfo.room.id+'.json',type:'post',timeout:35000,dataType:'json',data:{'last_chat_id':lastChatId,'last_time':lastTime}}).done(function(e){if(e['error']){location.reload();console.warn('Error!',e);setTimeout(function(){that.watch(lastChatId,lastTime);},500);return;}
if(e['updated']){lastChatId=e['last_chat_id'];lastTime=e['time'];dataUpdate(e);}
that.watch(lastChatId,lastTime);}).fail(function(){that.watch(lastChatId,lastTime);});}}
var server=new Server();
var changeTargetTab=null;$(document).on('change','#changeTabMode',function(e){if(!changeTargetTab)return cancelEvent(e);var mode=$(this).val();changeTargetTab.applyData({mode:mode}).send({text:changeTargetTab.getText(),mode:mode}).editor.focus();}).on('contextmenu','.tab-item',function(e){var viewerId=$(this).parents('.editor-root').attr('id');var tabName=$(this).data('tab-name');changeTargetTab=editorList.get(viewerId).changeActiveTab(tabName);if(changeTargetTab.isSelf){$(document.getElementById('changeTabMode')).val(changeTargetTab.getState().mode);}else{return cancelEvent(e);}});$.contextMenu({selector:'#'+roomInfo.viewer.viewer_id+' .tab-item',items:{changeTabMode:{name:'言語設定<select id="changeTabMode" class="form-control"><option value="abap">ABAP</option><option value="actionscript">ActionScript</option><option value="c_cpp">C++</option><option value="c_cpp">C</option><option value="cobol">COBOL</option><option value="coffee">CoffeeScript</option><option value="csharp">C#</option><option value="css">CSS</option><option value="clojure">Clojure</option><option value="d">D</option><option value="dart">Dart</option><option value="erlang">Erlang</option><option value="forth">Forth</option><option value="golang">Go</option><option value="groovy">Groovy</option><option value="haskell">Haskell</option><option value="haxe">Haxe</option><option value="java">Java</option><option value="javascript">JavaScript</option><option value="jsx">JSX</option><option value="lisp">Lisp</option><option value="lsl">LSL</option><option value="lua">Lua</option><option value="matlab">MATLAB</option><option value="mysql">MySQL</option><option value="objectivec">Objective-C</option><option value="markdown">Markdown</option><option value="ocaml">OCaml</option><option value="pascal">Pascal</option><option value="perl">Perl</option><option value="php">PHP</option><option value="plain_text">Plain Text</option><option value="prolog">Prolog</option><option value="python">Python</option><option value="r">R</option><option value="ruby">Ruby</option><option value="rust">Rust</option><option value="scala">Scala</option><option value="scheme">Scheme</option><option value="sh">ShellScript</option><option value="latex">LaTeX</option><option value="typescript">TypeScript</option><option value="vbscript">VBScript</option><option value="verilog">Verilog</option><option value="assembly_x86">Assembly x86</option><option value="xml">XML</option><option value="xquery">XQuery</option></select>',callback:function(e){return false;}}}});var EditorList=function(){this.editorList=[];}
EditorList.prototype={add:function(viewerId){this.editorList[viewerId]=new Editor(viewerId,4).hide();},remove:function(viewerId){for(var id in this.editorList){if(this.editorList[id]!==viewerId){continue;}
this.editorList[id].remove();delete this.editorList[id];break;}},changeViewingEditor:function(viewerId){for(var id in this.editorList){this.editorList[id].hide();}
if(void 0===this.editorList[viewerId]){console.warn("ユーザー '"+viewerId+"' が存在しません");return;}
this.editorList[viewerId].show();},get:function(viewerId){if(void 0===this.editorList[viewerId]){this.add(viewerId);}
return this.editorList[viewerId];},update:function(data){this.get(data.viewerId).get(data.tabName).applyData(data.data);if(data.viewerId===roomInfo.viewer.viewer_id)return;if(!this.get(data.viewerId).isViewing()){$(document.getElementsByClassName('viewer-list')).find('[data-viewer-id="'+data.viewerId+'"]').addClass('reception');}
if(this.get(data.viewerId).currentTabName!==data.tabName){$(document.getElementById(data.viewerId)).find('[data-tab-name="'+data.tabName+'"]').addClass('reception');}},resize:function(rootWidth,rootHeight){for(var prop in this.editorList){this.editorList[prop].resize(rootWidth,rootHeight);}},show:function(viewerId){this.editorList[viewerId].show();},setLayout:function(viewerId,state){if(void 0===this.editorList[viewerId]){this.add(viewerId);}
var pairPosition=[1,0,3,2,-1];var that=this;var $editors=this.editorList[viewerId].$editorRegion.find('.editor-root');if($editors.eq(0).attr('id')!==viewerId){$editors.not(':first').each(function(){that.editorList[$(this).attr('id')].hide();});}
this.editorList[viewerId].$root.prependTo(this.editorList[viewerId].$editorRegion);this.editorList[viewerId].show().setPosition(state).tabResize();for(var id in this.editorList){if(this.editorList[id].isViewing()&&id!==viewerId){if(pairPosition[state]===-1){this.editorList[id].hide();}else{this.editorList[id].show().setPosition(pairPosition[state]);}}}}}
var Editor=function(viewerId,state){$('#ko-cha-templates').find('.editor-root').clone().attr('id',viewerId).appendTo('#editor-region');this.viewerId=viewerId;this.tabList=[];this.currentTabName;this.$root=$(document.getElementById(this.viewerId));this.viewing=false;this.state=state;this.setPosition(state);this.$sidebar=$(document.getElementsByClassName('sidebar'));this.$editorRegion=$(document.getElementById('editor-region'));this.isSelf=viewerId===roomInfo.viewer.viewer_id;if(this.isSelf){var that=this;this.$editorRegion.find('.editor-top-bar').mousedown(function(){var timer=-1;return function(e){if($(e.target).parents('.tab-item').size()!==0){return;}
if(timer!==-1){clearTimeout(timer);timer=-1;that.addEmptyTab();}else{timer=setTimeout(function(){timer=-1;},400);}
return cancelEvent(e);}}());}}
Editor.prototype={getSizeRate:function(state){var rates={top:0,left:0,width:0,height:0};switch(state){case 0:rates.width=50;rates.height=100;break;case 1:rates.width=rates.left=50;rates.height=100;break;case 2:rates.height=50;rates.width=100;break;case 3:rates.height=rates.top=50;rates.width=100;break;case 4:rates.width=rates.height=100;break;}
return rates;},setPosition:function(state){this.state=state;var rates=this.getSizeRate(state);this.$root.css({'position':'relative','top':rates.top+'%','width':rates.width+'%','height':rates.height+'%'});this.$root.find('.editor-list').css({width:'100%',height:'100%'});var that=this;this.tabResize();$(window).resize();return this;},setLayout:function(tabName,state){console.log(tabName,state);},getPositionState:function(){return this.state},get:function(tabName){if(void 0===this.tabList[tabName]){this.addTab(tabName);}
return this.tabList[tabName];},addTab:function(tabName){if(tabName in this.tabList){console.warn('タブ名が重複しています.');return this.tabList[tabName];}
this.tabList[tabName]=new Tab(this.viewerId,tabName).hide();if(getSize(this.tabList)===1){this.changeActiveTab(tabName);}
this.tabResize();return this.tabList[tabName];},addEmptyTab:function(){var tabName='untitled',index='';while((tabName+index)in this.tabList){index++;}
this.addTab(tabName+index).applyData({mode:'c_cpp'}).send({mode:'c_cpp'});},tabResize:(function(){var timer;return function(){var that=this;clearTimeout(timer);timer=setTimeout(function(){var tabWidth=(that.$root.width()-100)/getSize(that.tabList);that.$root.find('.tab-item').width(tabWidth).find('.label').width(tabWidth-(tabWidth/200*60)-10);},100);}}()),removeTab:function(tabName){if(void 0===this.tabList[tabName])return;var target=this.$root.find('.tab-list').find('li[data-tab-name="'+tabName+'"]');var prev=target.prev().eq(0);var next=target.next().eq(0);var nextViewing=prev.size()?prev:next.size()?next:false;this.tabList[tabName].remove();delete this.tabList[tabName];this.$root.find('[data-tab-name="'+tabName+'"]').remove();if(this.currentTabName==tabName&&nextViewing!==false){this.changeActiveTab(nextViewing.data('tab-name'));}
if(this.isSelf){server.send({type:'editor_change_state',data:JSON.stringify({viewerId:this.viewerId,tabName:tabName,command:'removeTab'})});}else{}},hide:function(){this.viewing=false;this.$root.addClass('hidden');return this;},show:function(){this.viewing=true;this.$root.removeClass('hidden');$('.viewer-list').find('[data-viewer-id="'+this.viewerId+'"]').removeClass('reception');return this;},remove:function(){},resize:function(rootWidth,rootHeight){var rates=this.getSizeRate(this.state);this.$root.add(this.$root.find('.ace_editor')).css({'width':rootWidth*rates.width/100+'px','height':rootHeight*rates.height/100-35+'px'});this.$root.css('left',this.$sidebar.width()+20+(this.$editorRegion.width()*rates.left/100)+'px');for(var name in this.tabList){this.tabList[name].resize();}
if(this.isViewing()){this.tabResize();}},changeActiveTab:function(tabName){if(!(tabName in this.tabList)){console.warn("changeActiveTab 指定されたタブが存在しません: "+tabName);return;}
var $target=$(document.getElementById(this.viewerId));$target.find('.tab-item').removeClass('active').filter('[data-tab-name="'+tabName+'"]').addClass('active').removeClass('reception');for(var name in this.tabList){this.tabList[name].hide();}
this.tabList[tabName].show().resize();this.currentTabName=tabName;$(window).resize();return this.tabList[tabName];},isViewing:function(){return this.viewing;}}
var Tab=function(viewerId,tabName){this.editorId=viewerId+'-'+tabName;this.viewerId=viewerId;this.tabName=tabName;this.isSelf=viewerId===roomInfo.viewer.viewer_id;var that=this;var $root=$(document.getElementById(viewerId));var editorRegion=$(document.getElementById('editor-region'));var tabItemText='<li class="tab-item" data-tab-name="%s"><a class="label" title="">%s</a><a class="close" data-tab-name="%s">x</a></li>';var editorText='<div id="%s" data-tab-name="%s"></div>';$(sprintf(editorText,this.editorId,tabName)).width(editorRegion.width()).height(editorRegion.height()-37).appendTo($root.find('.editor-list:first'));$(sprintf(tabItemText,tabName,tabName,tabName)).appendTo($root.find('.tab-list'));this.$editor=$(document.getElementById(this.editorId));this.editor=ace.edit(this.editorId);this.editor.session.setUseSoftTabs(true);this.editor.setAnimatedScroll(true);this.setTheme('cobalt');this.setMode('c_cpp');this.editor.setFontSize(12);this.fileMoniterTick=null;this.fileLastMod=-1;if(this.viewerId!==roomInfo.viewer.viewer_id){this.editor.setReadOnly(true);}
this.update={range:function(that,range){that.editor.selection.setSelectionRange(range);},scroll:function(that,scroll){that.editor.session.setScrollTop(scroll.top);that.editor.session.setScrollLeft(scroll.left);},mode:function(that,mode){that.setMode(mode);},theme:function(that,theme){that.setTheme(theme);},text:function(that,text){var range=that.editor.session.selection.getRange();that.editor.setValue(text);that.editor.selection.setSelectionRange(range);},cursor:function(that,cursor){var current=that.editor.getCursorPosition();if(cursor.top!==current.top||cursor.left!==current.left){that.editor.moveCursorToPosition(cursor);}}}
var init=false;if(this.viewerId===roomInfo.viewer.viewer_id){this.editor.session.on('change',function(e){if(init)return;init=true;setTimeout(function(){that.init();},500);});}}
Tab.prototype={init:function(){var that=this;var sendState=(function(){var timer=null;return function(type,data){clearTimeout(timer);timer=setTimeout(function(){server.send({type:'editor_change_state',data:JSON.stringify({viewerId:that.viewerId,tabName:that.tabName,data:data})});},100);}}());var sendText=(function(){var timer=null;return function(type,data){clearTimeout(timer);timer=setTimeout(function(){server.send({type:'editor_change_text',data:JSON.stringify({viewerId:that.viewerId,tabName:that.tabName,data:{text:data}})});},100);}}());that.editor.session.on('change',function(e){sendText(0,that.getText());});that.editor.session.on('changeScrollLeft',function(){sendState(0,that.getState());});that.editor.session.on('changeScrollTop',function(){sendState(0,that.getState());});that.editor.session.selection.on('changeSelection',function(){sendState(0,that.getState());});that.editor.session.selection.on('changeCursor',function(){sendState(0,that.getState());});},send:function(textData){server.send({type:'editor_change_state',data:JSON.stringify({viewerId:this.viewerId,tabName:this.tabName,data:this.getState()})});server.send({type:'editor_change_text',data:JSON.stringify({viewerId:this.viewerId,tabName:this.tabName,data:textData})});return this;},setMoniteringFile:function(file,getTextFromArrayBuffer){var that=this;this.fileLastMod=file.lastModifiedDate;clearTimeout(this.fileMoniterTick);this.fileMoniterTick=setInterval(function(){if(that.fileLastMod.getTime()!==file.lastModifiedDate.getTime()){that.fileLastMod=file.lastModifiedDate;var reader=new FileReader();reader.onload=function(e){that.applyData({text:getTextFromArrayBuffer(e.target.result)});}
reader.readAsArrayBuffer(file);}},1000);return this;},show:function(){this.$editor.removeClass('hidden');return this;},hide:function(){this.$editor.addClass('hidden');return this;},setTheme:function(theme){theme="ace/theme/"+theme;this.editor.setTheme(theme);return this;},setMode:function(mode){mode="ace/mode/"+mode;this.editor.session.setMode(mode);return this;},setFontSize:function(size){this.editor.setFontSize(size|0);return this;},resize:function(){this.editor.resize();return this;},getText:function(){return this.editor.getValue();},getState:function(){return{scroll:{top:this.editor.session.getScrollTop(),left:this.editor.session.getScrollLeft()},cursor:this.editor.getCursorPosition(),range:this.editor.session.selection.getRange(),theme:this.editor.getTheme().substr(10),mode:this.editor.session.getMode().$id.substr(9)};},applyData:function(data){for(var prop in data)if(data.hasOwnProperty(prop)){if(prop in this.update){this.update[prop](this,data[prop]);}else{console.log('プロパティがありません。',data);}}
return this;},remove:function(){clearTimeout(this.fileMoniterTick);this.editor.destroy();return this;}}
var editorList=new EditorList();
$(function(){var PhantomFrame=function(r,g,b){this.phantomFrame=$('<dvi></div>').addClass('phantom-frame').css({'background-color':'rgba('+r+', '+g+', '+b+', 0.05)','border':'1px solid '+'rgb('+r+', '+g+', '+b+')','top':0,'left':0,'width':0,'height':0}).appendTo('body');}
PhantomFrame.prototype={remove:function(){this.phantomFrame.remove();},moveTo:function(top,left,width,height){this.phantomFrame.css({'top':top,'left':left,'width':width+'px','height':height+'px'});}}
var Sidebar={dragging:false,startX:0,beforeWidth:0,$sidebar:$(document.getElementsByClassName('sidebar')).width('20%'),$editorRegion:$(document.getElementById('editor-region')),windowWidth:$(window).width(),minSidebarWidth:94,sizeChangedCallback:null,setCallback:function(callback){this.sizeChangedCallback=callback;return this;},dragStart:function(startX){this.dragging=true;this.startX=startX;this.beforeWidth=this.$sidebar.width();this.windowWidth=$(window).width();},dragEnd:function(){if(this.dragging){}
this.dragging=false;},dragMoveTo:function(pageX){if(!this.dragging)return;var movedAmount=pageX-this.startX;var afterWidth=rangeFilter(movedAmount+this.beforeWidth,this.minSidebarWidth,this.windowWidth-50);this.resize(this.windowWidth,afterWidth);},resize:function(windowWidth,afterWidth){if(afterWidth===0)afterWidth=this.$sidebar.width();var editorPixelWidth=(windowWidth-afterWidth-30);var sidebarWidth=(afterWidth)/windowWidth*100;var editorWidth=editorPixelWidth/windowWidth*100;this.$editorRegion.width(editorWidth+'%');this.$sidebar.width(sidebarWidth+'%');this.sizeChangedCallback();}}
var Tab={dragging:false,startX:0,startY:0,startOffsetX:0,startOffsetY:0,tabMoving:false,target:null,targetId:null,phantomTab:$('.phantom-tab'),targetTabWidth:0,$root:null,rootOffset:null,rootWidth:null,rootHeight:null,isInside:null,phantomFrame:null,frameState:-1,dragStart:function(startX,startY,target){this.dragging=true;this.startY=startY;this.startX=startX;this.startOffsetX=startX-$(target).offset().left;this.startOffsetY=startY-$(target).offset().top;this.target=target;this.$root=$(target).parents('.editor-root');this.rootOffset=this.$root.offset();this.rootWidth=this.$root.width();this.rootHeight=this.$root.height();this.targetId=this.$root.attr('id');editorList.get(this.targetId).changeActiveTab($(target).data('tab-name'));this.targetTabWidth=$(target).width();},dragEnd:function(){if(!this.dragging)return;this.tabMoving=false;this.dragging=false;this.phantomTab.remove();if(this.frameState!==-1){editorList.get(this.targetId).setLayout($(this.target).data('tab-name'),this.frameState);this.frameState=-1;}
if(this.isInside){this.removePhantomFrame();this.isInside=false;}},dragMoveTo:function(pageX,pageY){if(!this.dragging)return;if(this.targetId!==roomInfo.viewer.viewer_id)return;var movedAmountX=pageX-this.startX;var movedAmountY=pageY-this.startY;if(!this.tabMoving){if(-5<movedAmountX&&movedAmountX<5){return;}
this.generatePhantomTab();this.tabMoving=true;}
this.phantomTab.css({'left':pageX-this.startOffsetX,'top':pageY-this.startOffsetY});if(-30<movedAmountY&&movedAmountY<30){if(movedAmountX>this.targetTabWidth>>1){this.swap(this.target,'right');}else if(movedAmountX<-this.targetTabWidth>>1){this.swap(this.target,'left');}
this.removePhantomFrame();}
var rootOffset={};rootOffset.left=this.rootOffset.left;rootOffset.top=this.rootOffset.top;var localX=pageX-rootOffset.left;var localY=pageY-rootOffset.top;var width=this.$root.width();var height=this.$root.height();var widthThreshold=0.3;var heightThreshold=0.4;if(localX<0||localX>this.rootWidth||localY<0||localY>this.rootHeight){if(this.isInside){this.removePhantomFrame();}
return;}
if(!this.isInside){this.phantomFrame=new PhantomFrame(255,0,0);this.isInside=true;return;}
var state=0;if(localX<width*widthThreshold){width>>=1;}else if(localX>width-width*widthThreshold){state=1;width>>=1;rootOffset.left+=width;}else if(localY<height*heightThreshold){state=2;height>>=1;}else if(localY>height-height*heightThreshold){state=3;height>>=1;rootOffset.top+=height;}else{state=4;}
if(state!==this.frameState){this.phantomFrame.moveTo(rootOffset.top+34,rootOffset.left,width,height);this.frameState=state;}},generatePhantomTab:function(){this.phantomTab=$(this.target).clone().addClass('phantom-tab').appendTo('body');},removePhantomFrame:function(){this.frameState=-1;this.phantomFrame&&this.phantomFrame.remove();this.isInside=false;},swap:function(target,direction){switch(direction){case'left':var $prev=$(target).prev();this.startX-=this.targetTabWidth;$(target).insertBefore($prev).css({'left':this.targetTabWidth}).animate({'left':0},0);break;case'right':var $next=$(target).next();this.startX+=this.targetTabWidth;$(target).insertAfter($next).css({'left':-this.targetTabWidth}).animate({'left':0},0);break;}}}
var Icon={startX:0,startY:0,isPress:false,dragging:false,isInside:false,iconMoving:false,$target:null,$root:$(document.getElementById('editor-region')),phantomIcon:$(document.getElementsByClassName('phantom-icon')),phantomFrame:$(document.getElementsByClassName('phantom-frame')),frameState:-1,dragStart:function(pageX,pageY,target){this.startY=pageY;this.startX=pageX;this.isPress=true;this.$target=$(target);},dragEnd:function(pageX,pageY){this.isPress=false;this.dragging=false;this.iconMoving=false;this.isInside=false;this.phantomIcon.remove();this.phantomFrame.remove();if(this.frameState!==-1){editorList.setLayout(this.$target.data('viewer-id'),this.frameState);this.frameState=-1;}
var threshold=3;var movedAmountX=pageX-this.startX;var movedAmountY=pageY-this.startY;if(!(movedAmountX<-threshold||movedAmountX>threshold||movedAmountY<-threshold||movedAmountY>threshold)){editorList.setLayout(this.$target.data('viewer-id'),4);}},dragMoveTo:function(pageX,pageY){if(!this.isPress)return;var movedAmountX=this.startX-pageX;var movedAmountY=this.startY-pageY;var threshold=10;if(movedAmountX<-threshold||movedAmountX>threshold||movedAmountY<-threshold||movedAmountY>threshold){this.dragging=true;}
if(!this.dragging)return;if(!this.iconMoving){this.generatePhantomIcon();}
this.iconMoving=true;this.phantomIcon.css({'left':pageX-this.$target.width(),'top':pageY-this.$target.height()});var editorOffset=this.$root.offset();var localX=pageX-editorOffset.left;var localY=pageY-editorOffset.top;var width=this.$root.width();var widthThreshold=0.3;var height=this.$root.height();var heightThreshold=0.4;if(localX<0||localY<0){if(this.isInside){this.phantomFrame.remove();this.isInside=false;this.frameState=-1;}
return;}
if(!this.isInside){this.phantomFrame=new PhantomFrame(0,255,0);this.isInside=true;return;}
var state=0;if(localX<width*widthThreshold){width>>=1;}else if(localX>width-width*widthThreshold){state=1;width>>=1;editorOffset.left+=width;}else if(localY<height*heightThreshold){state=2;height>>=1;}else if(localY>height-height*heightThreshold){state=3;height>>=1;editorOffset.top+=height;}else{state=4;}
if(state!==this.frameState){this.phantomFrame.moveTo(editorOffset.top,editorOffset.left,width,height);this.frameState=state;}},generatePhantomIcon:function(){this.phantomIcon=$('<div></div>').clone().addClass('phantom-icon').css({'background-image':this.$target.css('background-image'),'width':this.$target.width()*2,'height':this.$target.height()*2}).appendTo('body');}}
function isSelf(e){return $(e.target).parents('.editor-root').attr('id')===roomInfo.viewer.viewer_id;}
Sidebar.setCallback(editorResize);$(document).on('mousedown','.sidebar-handle',function(e){Sidebar.dragStart(e.pageX);return cancelEvent(e);}).on('mousedown','.tab-item',function(e){if(isSelf(e)&&$(this).find('.close')[0]===e.target){editorList.get($(this).parents('.editor-root').attr('id')).removeTab($(this).data('tab-name'));}else{Tab.dragStart(e.pageX,e.pageY,this);}
return cancelEvent(e);}).on('mousedown','header .viewer-icon',function(e){Icon.dragStart(e.pageX,e.pageY,this);return cancelEvent(e);}).on('mouseup',function(e){Sidebar.dragEnd();Icon.dragEnd(e.pageX,e.pageY);Tab.dragEnd();return cancelEvent(e);}).on('mousemove',function(e){Sidebar.dragMoveTo(e.pageX);Icon.dragMoveTo(e.pageX,e.pageY);Tab.dragMoveTo(e.pageX,e.pageY);return cancelEvent(e);});$(window).resize(function(){var height=$(window).height();$('.wrapper').height(height+'px');Sidebar.resize($(window).width(),0);}).resize();function editorResize(){var editorRegion=$('#editor-region');editorList.resize(editorRegion.width(),editorRegion.height());}});
var Viewer=function(editorList){var $templates=$('#ko-cha-templates');this.$icon=$templates.find('.viewer-icon').clone();this.editorList=editorList;$('.js_my_icon').addClass(roomInfo.viewer.viewer_id).css({'background-image':'url('+this.getImageUrl(roomInfo.viewer.image)+')'});this.add(roomInfo.viewer);editorList.setLayout(roomInfo.viewer.viewer_id,4);}
Viewer.prototype={update:function(data){for(var i in data){if(data[i].viewer_id in this.editorList.editorList){var image=this.getImageUrl(data[i].image);this.changeIcon(image,data[i].viewer_id);$('.viewer-list').find('[data-viewer-id="'+data[i].viewer_id+'"]').addClass(data[i].viewer_id).css('background-image','url('+image+')');$('#'+data[i].viewer_id).find('.editor-user-icon').css('background-image','url('+image+')').addClass(data[i].viewer_id);}else{this.add(data[i]);}}},add:function(data){this.editorList.add(data.viewer_id);var image=this.getImageUrl(data.image);this.$icon.clone().attr('data-viewer-id',data.viewer_id).addClass(data.viewer_id).css('background-image','url('+image+')').appendTo(".viewer-list");$('#'+data.viewer_id).find('.editor-user-icon').css('background-image','url('+image+')').addClass(data.viewer_id).mouseenter(function(){$(this).addClass('hidden');var that=this;setTimeout(function(){$(that).removeClass('hidden')},2000);});if(roomInfo.viewer.viewer_id===data.viewer_id){$('#'+data.viewer_id).addClass('self-editor');}},getImageUrl:function(data){data=""+data;return data.length<10?'/ko-cha2/assets/img/user/default/'+data+'.png':data;},changeIcon:(function(){var viewerInfoMap={};return function(image,viewerId){if(viewerId===roomInfo.viewer.viewer_id){roomInfo.viewer.image=image;}
if(!(viewerId in viewerInfoMap)){viewerInfoMap[viewerId]="";}
if(viewerInfoMap[viewerId]!==image){viewerInfoMap[viewerId]=image;$('.'+viewerId).css('background-image','url('+image+')');}}}())}
var viewer=new Viewer(editorList);window.onbeforeunload=function(){server.send({type:'exit_viewer',data:roomInfo.viewer.viewer_id},true);}
$('.sns-login').find('span').click(function(){var sns=$(this).data('sns');var url='/ko-cha2/auth/login/'+sns;window.open(url,'','width=800,height=500');});function snsApply(image,name){server.send({type:'update_image',data:{'image':image,'name':name}});}
$(function(){function getModeByExt(ext){return{'abp':'abap','as':'actionscript','c':'c_cpp','h':'c_cpp','cpp':'c_cpp','hpp':'c_cpp','cobol':'cobol','coffee':'coffee','cs':'csharp','css':'css','clj':'clojure','d':'d','dart':'dart','erl':'erlang','forth':'forth','go':'golang','groovy':'groovy','hs':'haskell','lhs':'haskell','hx':'haxe','html':'html','htm':'html','xhtml':'html','svg':'html','java':'java','js':'javascript','jsx':'jsx','lisp':'lisp','lsl':'lsl','lua':'lua','mat':'matlab','sql':'mysql','m':'objectivec','md':'markdown','ml':'ocaml','pas':'pascal','pl':'perl','php':'php','pro':'prolog','swi':'prolog','py':'python','r':'r','rb':'ruby','rs':'rust','scala':'scala','scm':'scheme','sh':'sh','tex':'latex','ts':'typescript','vbs':'vbscript','v':'verilog','asm':'assembly_x86','xml':'xml','xquery':'xquery'}[ext.toLocaleLowerCase()]||'plain_text';}
function getExtByFilename(fileName){return fileName.substr(fileName.lastIndexOf('.')+1);}
var droppable=$(document);function cancelEvent(e){e.preventDefault();e.stopPropagation();return false;}
function handleDroppedFile(e){var files=e.originalEvent.dataTransfer.files;console.log(files)
for(var i=0;i<files.length;i++){var file=files[i];if(file.size>=5*1000*1000){alert('ファイルサイズが5MBを超えています: ['+(file.size/1000000)+'MB]');continue;}
if(file.type.match('image.*')){uploadImage(file);}else{readFile(file);}}
return cancelEvent(e);}
function uploadImage(file){var uploadData=new FormData();uploadData.append('file',file);$.ajax({url:'/ko-cha2/chat/upload/'+roomInfo.room.id+'.json',type:'post',dataType:'json',contentType:false,processData:false,data:uploadData}).done(function(json){for(var i in json){sendChat('[image]'+json[i]+'[/image]');}});return;}
function readFile(file){if(!window.FileReader){alert("File API がサポートされていません。");return false;}
var ext=getExtByFilename(file.name);var fileReader=new FileReader();fileReader.onload=function(e){var targetEditor=editorList.get(roomInfo.viewer.viewer_id);var targetTab=targetEditor.addTab(file.name);var text=getTextFromArrayBuffer(e.target.result);targetTab.setMoniteringFile(file,getTextFromArrayBuffer).applyData({text:text,mode:getModeByExt(ext)});targetTab.send({text:text,mode:getModeByExt(ext)});if(!targetEditor.isViewing()){editorList.setLayout(roomInfo.viewer.viewer_id,4);}
targetEditor.changeActiveTab(file.name);}
fileReader.readAsArrayBuffer(file);}
function getTextFromArrayBuffer(arrayBuffer){var array=new Uint8Array(arrayBuffer);switch(Encoding.detect(array)){case'UTF16':array=new Uint16Array(arrayBuffer);break;case'UTF32':array=new Uint32Array(arrayBuffer);break;}
array=Encoding.convert(array,'UNICODE');return Encoding.codeToString(array);}
droppable.bind("dragenter",cancelEvent);droppable.bind("dragover",cancelEvent);droppable.bind("drop",handleDroppedFile);});
var Chat={$log:$('.chat_log'),initialized:false,regexURL:/(?:^|[\s　]+)((?:https?|ftp):\/\/[^\s　]+)/,logText:'<div class="letter"><span class="viewer-icon %s" style="background-image:url(%s)"></span>%s</div>',linkText:'<a href="%s" target="_blank">%s</a>',init:function(){this.initialized=true;return this;},insert:function(logs,selfEnter){var html='';for(var i in logs){var data=logs[i];if(!selfEnter&&this.initialized&&roomInfo.viewer.viewer_id===data.viewer_id)continue;var string="",isImage=false;if(data.message.match('\\[image\\](.*)\\[/image\\]')){isImage=true;string=this.genImageHTML(data);}else{string=this.genRemarkHTML(data);}
html=string+html;if(this.initialized&&roomInfo.viewer.viewer_id!==data.viewer_id){executeIfNotViewing(function(){var myNotification=new Notify('Ko-cha',{icon:viewer.getImageUrl(data.image),body:isImage?"画像を送信しました。":data.message});myNotification.show();});}}
this.init().$log.prepend(html).scrollTop(0);$('.fancybox').fancybox({autoSize:true});},genRemarkHTML:function(log){var message=this.escapeHTML(log.message).replace(this.regexURL,function(){var url="";log.message.replace(this.regexURL,function($1,$2){url=$2;});return sprintf(this.linkText,url,url);});return sprintf(this.logText,log.viewer_id,viewer.getImageUrl(log.image),message);},genImageHTML:function(log){var imageName=log.message.match('\\[image\\](.*)\\[/image\\]')[1];var baseUrl='assets/upload/'+roomInfo.room.id+'/';var imageUrl=baseUrl+imageName;var thumbExt=imageName.substr(-3).toLowerCase();var thumbUrl=baseUrl+'thumb-'+imageName.substr(0,imageName.length-3)+thumbExt;var image='画像を送信しました。<a href="'+imageUrl+'" class="fancybox" title=""><img src="'+thumbUrl+'"></a>';return sprintf(this.logText,log.viewer_id,viewer.getImageUrl(log.image),image);},escapeHTML:function(str){var obj=document.createElement('pre');if(typeof obj.textContent!='undefined'){obj.textContent=str;}else{obj.innerText=str;}
return obj.innerHTML;}}
$('.js_chat_send').keydown(function(e){var eCode=e.keyCode||e.charCode,message=$(this).val();if(eCode!==13||!message)return;sendChat(message);$(this).val('');});function sendChat(message){var data=roomInfo.viewer;data['message']=message;Chat.insert([data],true);server.send({type:'chat_log',data:message});}
function executeIfNotViewing(callback){var rendered=false;requestAnimationFrame(function(){rendered=true;});setTimeout(function(){if(!rendered)callback();},600);}
var command={removeTab:function(editorData){editorList.get(editorData.viewerId).removeTab(editorData.tabName);}}
function dataUpdate(e){if(!e.updated)return;for(var state in e){if(state==='editor_change_state'||state==='editor_change_text'){for(var i in e[state].data){var editorData=JSON.parse(e[state].data[i].data);if(editorData.command!==undefined){if(editorData.command in command){command[editorData.command](editorData);}}else{editorList.update(editorData);}}}else if(state==='update_viewer'){viewer.update(e[state].list);}else if(state==='chat_log'){Chat.insert(e[state]);}}}
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-46848282-1','setchi.jp');ga('send','pageview');!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=737265849616897";fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));
